# è³‡æºåŒ…è‡ªå‹•æ¥å—åŠŸèƒ½é™¤éŒ¯è¨˜éŒ„

## å•é¡Œæè¿°

Bot åœ¨é€£æ¥åˆ°ä½¿ç”¨ Nexo æ’ä»¶çš„ Minecraft 1.21.8 ä¼ºæœå™¨æ™‚ï¼Œæœƒå¡åœ¨ configuration éšæ®µï¼Œç„¡æ³•æ­£å¸¸é€²å…¥éŠæˆ²ã€‚

**ç›®æ¨™ä¼ºæœå™¨:** mcborder.com:25565
**Minecraft ç‰ˆæœ¬:** 1.21.8
**æ’ä»¶:** Nexo (è‡ªè¨‚ç‰©å“æè³ªåŒ…)

---

## é™¤éŒ¯éç¨‹

### å•é¡Œ 1: Bot å¡åœ¨åˆå§‹åŒ–éšæ®µ

**ç¾è±¡:**
```
[MapArtBuilder] å·²è¨­ç½®åœ°æ¯¯æœå°‹æ¨¡çµ„
[BuildMode] å·²è¨­ç½®åœ°æ¯¯æœå°‹æ¨¡çµ„
ï¼ˆå¡ä½ï¼Œæ²’æœ‰ä»»ä½•é€²å±•ï¼‰
```

**åˆ†æ:**
- Bot é€£ `login` äº‹ä»¶éƒ½æ²’æœ‰è§¸ç™¼
- é€£æ¥æœ¬èº«å°±æ²’æœ‰å»ºç«‹æˆåŠŸ

**è§£æ±ºæ–¹æ¡ˆ:**
æ·»åŠ é€£æ¥éšæ®µçš„è©³ç´°èª¿è©¦ä¿¡æ¯ï¼š
```javascript
bot._client.on('connect', () => {
  console.log('[Connection] âœ“ TCP é€£æ¥å·²å»ºç«‹')
})

bot._client.on('session', () => {
  console.log('[Connection] âœ“ æœƒè©±å·²å»ºç«‹')
})

bot._client.on('state', (newState) => {
  console.log(`[Connection] ç‹€æ…‹è®Šæ›´: ${newState}`)
})
```

**çµæœ:**
ç™¼ç¾ bot é€²å…¥äº† `configuration` ç‹€æ…‹ï¼Œä½†åœ¨é€™å€‹éšæ®µå¡ä½äº†ã€‚

---

### å•é¡Œ 2: è³‡æºåŒ…è™•ç†å™¨å•Ÿç”¨æ™‚æ©Ÿä¸æ­£ç¢º

**ç¾è±¡:**
```
[Connection] ç‹€æ…‹è®Šæ›´: login
[Connection] ç‹€æ…‹è®Šæ›´: configuration
ï¼ˆå¡ä½ï¼‰
```

**åˆ†æ:**
- è³‡æºåŒ…è™•ç†å™¨åœ¨ `login` äº‹ä»¶æ™‚æ‰å•Ÿç”¨
- ä½†åœ¨ 1.20.2+ ç‰ˆæœ¬ä¸­ï¼Œè³‡æºåŒ…åœ¨ `configuration` éšæ®µç™¼é€
- `login` äº‹ä»¶åœ¨ `configuration` éšæ®µä¹‹å‰è§¸ç™¼
- è³‡æºåŒ…è™•ç†å™¨å•Ÿç”¨å¤ªæ™šï¼ŒéŒ¯éäº†è³‡æºåŒ…è«‹æ±‚

**1.20.2+ é€£æ¥æµç¨‹:**
1. `connect` â†’ TCP é€£æ¥å»ºç«‹
2. `session` â†’ æœƒè©±å»ºç«‹
3. `state: login` â†’ ç™»å…¥ç‹€æ…‹
4. **`state: configuration`** â† è³‡æºåŒ…åœ¨é€™è£¡ç™¼é€ï¼
5. `spawn` â†’ é€²å…¥éŠæˆ²

**è§£æ±ºæ–¹æ¡ˆ:**
åœ¨ bot å¯¦ä¾‹å‰µå»ºå¾Œç«‹å³å•Ÿç”¨è³‡æºåŒ…è™•ç†å™¨ï¼š
```javascript
// âŒ éŒ¯èª¤ï¼šå¤ªæ™šäº†
bot.once('login', () => {
  resourcePackHandler.enable()
})

// âœ… æ­£ç¢ºï¼šç«‹å³å•Ÿç”¨
const bot = mineflayer.createBot(opts)
resourcePackHandler.enable()
```

---

### å•é¡Œ 3: ç›£è½éŒ¯èª¤çš„å°åŒ…åç¨±

**ç¾è±¡:**
æ·»åŠ é€šç”¨å°åŒ…ç›£è½å™¨å¾Œç™¼ç¾ï¼š
```
[Debug] æ”¶åˆ°å°åŒ…: remove_resource_pack {}
[Debug] æ”¶åˆ°å°åŒ…: add_resource_pack { ... }
```

**åˆ†æ:**
- ç›£è½çš„æ˜¯ `resource_pack_send`
- å¯¦éš›æ”¶åˆ°çš„æ˜¯ `add_resource_pack`
- 1.20.3+ æ”¹è®Šäº†å°åŒ…åç¨±

**å”è­°è®Šæ›´:**
| ç‰ˆæœ¬ | æ¥æ”¶å°åŒ… | å›æ‡‰å°åŒ… |
|------|----------|----------|
| 1.20.2- | `resource_pack_send` | `resource_pack_receive` |
| 1.20.3+ | `add_resource_pack` | `resource_pack_receive` |

**è§£æ±ºæ–¹æ¡ˆ:**
åŒæ™‚ç›£è½æ–°èˆŠå…©ç¨®å°åŒ…åç¨±ï¼š
```javascript
// 1.20.3+ ä½¿ç”¨ add_resource_pack
bot._client.on('add_resource_pack', (packet) => {
  this.handleResourcePackRequest(packet)
})

// èˆŠç‰ˆæœ¬ä½¿ç”¨ resource_pack_send
bot._client.on('resource_pack_send', (packet) => {
  this.handleResourcePackRequest(packet)
})
```

---

### å•é¡Œ 4: å›æ‡‰å°åŒ…æ ¼å¼éŒ¯èª¤

**ç¾è±¡:**
```
[ResourcePack] âš¡ æ•ç²åˆ° add_resource_pack å°åŒ…ï¼
[ResourcePack] âœ“ å·²æ¥å—è³‡æºåŒ…
è¢«ä¼ºæœå™¨è¸¢å‡º: ä½ çš„é€£ç·šç™¼ç”Ÿå…§éƒ¨éŒ¯èª¤
```

**åˆ†æ:**
- æˆåŠŸæ¥æ”¶åˆ°è³‡æºåŒ…è«‹æ±‚
- ç™¼é€äº†å›æ‡‰ï¼Œä½†è¢«ä¼ºæœå™¨è¸¢å‡º
- "å…§éƒ¨éŒ¯èª¤" é€šå¸¸è¡¨ç¤ºå°åŒ…æ ¼å¼ä¸æ­£ç¢º

**å˜—è©¦ 1: ä½¿ç”¨ `resource_pack_status`**
```javascript
// âŒ éŒ¯èª¤
bot._client.write('resource_pack_status', {
  uuid: uuid,
  result: 3
})
```
çµæœï¼šä¼ºæœå™¨è¸¢å‡º

**å˜—è©¦ 2: ä½¿ç”¨ `resource_pack_receive` + UUID**
```javascript
// âœ… æ­£ç¢ºï¼
bot._client.write('resource_pack_receive', {
  uuid: uuid,
  result: 3
})
```
çµæœï¼šæˆåŠŸï¼

**é—œéµç™¼ç¾:**
é›–ç„¶æ¥æ”¶å°åŒ…åç¨±æ”¹ç‚º `add_resource_pack`ï¼Œä½†å›æ‡‰å°åŒ…ä»ç„¶ä½¿ç”¨ `resource_pack_receive`ï¼Œä¸¦ä¸”éœ€è¦åŒ…å« UUIDã€‚

---

## æœ€çµ‚è§£æ±ºæ–¹æ¡ˆ

### 1. ç›£è½æ­£ç¢ºçš„å°åŒ…
```javascript
bot._client.on('add_resource_pack', (packet) => {
  this.handleResourcePackRequest(packet)
})
```

### 2. åœ¨æ­£ç¢ºæ™‚æ©Ÿå•Ÿç”¨
```javascript
// åœ¨ bot å¯¦ä¾‹å‰µå»ºå¾Œç«‹å³å•Ÿç”¨
const bot = mineflayer.createBot(opts)
resourcePackHandler.enable()
```

### 3. ç™¼é€æ­£ç¢ºæ ¼å¼çš„å›æ‡‰
```javascript
// ä¸‰éšæ®µå›æ‡‰åºåˆ—
// éšæ®µ 1: æ¥å—
bot._client.write('resource_pack_receive', {
  uuid: packet.uuid,
  result: 3  // accepted
})

// éšæ®µ 2: ä¸‹è¼‰å®Œæˆï¼ˆ50ms å¾Œï¼‰
bot._client.write('resource_pack_receive', {
  uuid: packet.uuid,
  result: 4  // downloaded
})

// éšæ®µ 3: è¼‰å…¥å®Œæˆï¼ˆå† 50ms å¾Œï¼‰
bot._client.write('resource_pack_receive', {
  uuid: packet.uuid,
  result: 0  // successfully_loaded
})
```

---

## å®Œæ•´çš„å°åŒ…æµç¨‹

### æ¥æ”¶åˆ°çš„å°åŒ… (add_resource_pack)
```json
{
  "uuid": "f8992931-2b02-3289-8756-218fd7e3f71a",
  "url": "https://atlas.nexomc.com/pack.zip?id=0d4cd69dfe7f569b173a334361ed1dc5a4dd7ee2",
  "hash": "0d4cd69dfe7f569b173a334361ed1dc5a4dd7ee2",
  "forced": true,
  "promptMessage": {
    "type": "compound",
    "value": {
      "color": { "type": "string", "value": "#FA4943" },
      "text": { "type": "string", "value": "è«‹ä½¿ç”¨ä¼ºæœå™¨æè³ªåŒ…ï¼Œå®Œæ•´é«”é©—éŠæˆ²å…§å®¹ã€‚" }
    }
  }
}
```

### ç™¼é€çš„å›æ‡‰å°åŒ… (resource_pack_receive)
```javascript
// å›æ‡‰ 1
{ uuid: "f8992931-2b02-3289-8756-218fd7e3f71a", result: 3 }

// å›æ‡‰ 2 (50ms å¾Œ)
{ uuid: "f8992931-2b02-3289-8756-218fd7e3f71a", result: 4 }

// å›æ‡‰ 3 (å† 50ms å¾Œ)
{ uuid: "f8992931-2b02-3289-8756-218fd7e3f71a", result: 0 }
```

---

## æˆåŠŸæ—¥èªŒ

```
[Connection] ç‹€æ…‹è®Šæ›´: configuration
[ResourcePack] âš¡ æ•ç²åˆ° add_resource_pack å°åŒ…ï¼ˆ1.20.3+ï¼‰ï¼
[ResourcePack] æ”¶åˆ°è³‡æºåŒ…è«‹æ±‚:
  URL: https://atlas.nexomc.com/pack.zip?id=...
  Hash: 0d4cd69dfe7f569b173a334361ed1dc5a4dd7ee2
  Forced: true
[ResourcePack] ğŸ“¥ è™•ç†è³‡æºåŒ…è«‹æ±‚ (1.20.3+)
[ResourcePack] âœ“ å·²æ¥å—è³‡æºåŒ…
[ResourcePack] âœ“ è³‡æºåŒ…ä¸‹è¼‰å®Œæˆ
[ResourcePack] âœ… è³‡æºåŒ…è¼‰å…¥å®Œæˆ
botå·²æˆåŠŸå•Ÿå‹•!
```

---

## é—œéµè¦é»ç¸½çµ

### âœ… å¿…é ˆåšçš„äº‹æƒ…

1. **ç«‹å³å•Ÿç”¨ç›£è½å™¨** - åœ¨ bot å¯¦ä¾‹å‰µå»ºå¾Œç«‹å³å•Ÿç”¨ï¼Œä¸è¦ç­‰ login æˆ– spawn
2. **ç›£è½ add_resource_pack** - 1.20.3+ ä½¿ç”¨æ–°çš„å°åŒ…åç¨±
3. **å›æ‡‰ä½¿ç”¨ resource_pack_receive** - é›–ç„¶æ¥æ”¶å°åŒ…åç¨±æ”¹äº†ï¼Œä½†å›æ‡‰ä»ç”¨èˆŠåç¨±
4. **å¿…é ˆåŒ…å« UUID** - å›æ‡‰å°åŒ…å¿…é ˆåŒ…å«è³‡æºåŒ…çš„ UUID
5. **ä¸‰éšæ®µå›æ‡‰** - accepted â†’ downloaded â†’ successfully_loaded

### âŒ å¸¸è¦‹éŒ¯èª¤

1. âŒ åœ¨ login äº‹ä»¶æ™‚æ‰å•Ÿç”¨ç›£è½å™¨ï¼ˆå¤ªæ™šäº†ï¼‰
2. âŒ ç›£è½ resource_pack_sendï¼ˆèˆŠå°åŒ…åç¨±ï¼‰
3. âŒ ä½¿ç”¨ resource_pack_status å›æ‡‰ï¼ˆéŒ¯èª¤çš„å°åŒ…åç¨±ï¼‰
4. âŒ å›æ‡‰ä¸åŒ…å« UUIDï¼ˆæœƒè¢«è¸¢å‡ºï¼‰
5. âŒ åªç™¼é€ä¸€å€‹ç‹€æ…‹ï¼ˆNexo éœ€è¦å®Œæ•´åºåˆ—ï¼‰

---

## èª¿è©¦æŠ€å·§

### 1. ç›£è½æ‰€æœ‰å°åŒ…
```javascript
bot._client.on('packet', (data, meta) => {
  if (meta.name && meta.name.toLowerCase().includes('resource')) {
    console.log(`[Debug] æ”¶åˆ°å°åŒ…: ${meta.name}`, JSON.stringify(data, null, 2))
  }
})
```

### 2. ç›£è½é€£æ¥ç‹€æ…‹
```javascript
bot._client.on('state', (newState) => {
  console.log(`[Connection] ç‹€æ…‹è®Šæ›´: ${newState}`)
})
```

### 3. éŒ¯èª¤è™•ç†
```javascript
try {
  bot._client.write('resource_pack_receive', { ... })
  console.log('[ResourcePack] âœ“ ç™¼é€æˆåŠŸ')
} catch (err) {
  console.error('[ResourcePack] ç™¼é€å¤±æ•—:', err.message)
}
```

---

## åƒè€ƒè³‡æ–™

- Wiki.vg Protocol Documentation: https://wiki.vg/Protocol
- Mineflayer GitHub: https://github.com/PrismarineJS/mineflayer
- Minecraft Protocol Changes (1.20.3): https://wiki.vg/Protocol_History

---

**é™¤éŒ¯å®Œæˆæ™‚é–“:** 2025
**æœ€çµ‚ç‹€æ…‹:** âœ… æˆåŠŸ
**ç¸½è€—æ™‚:** ç´„ 30 åˆ†é˜
**é—œéµçªç ´:** ç™¼ç¾å°åŒ…åç¨±è®Šæ›´ (`add_resource_pack`)
