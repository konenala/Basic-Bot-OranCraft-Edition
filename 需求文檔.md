### 專案需求說明（現有功能）

#### 一、簡介
- 這是基於 Mineflayer 的 Minecraft 自動化機器人，支援 Microsoft（正版）與離線模式登入（依 `config.json` 設定）。
- 連線後提供聊天轉發、TPA 白名單、自動化指令觸發、死亡回復與自動重連等功能。

#### 二、執行與環境
- Node.js 環境（版本相容以 `mineflayer@4.x` 為基準）。
- 安裝依賴後以 `node main.js` 啟動。

#### 三、設定檔（`config.json`）
- `username`：登入帳號識別。
- `ip` / `port`：伺服器位址與埠（預設 25565）。
- `auth`：`microsoft` 或 `offline`。
- `language`：語系標記（目前僅作為標示）。
- `whitelist`：允許自動接受 TPA 的玩家名單（只保留英文、數字、底線）。
- `version`：Minecraft 協定版本字串；留空則交由 Mineflayer 嘗試自動偵測。

可選登入快取（預設不保存）：
- `main.js` 的 `opt` 可啟用 `tokensLocation` 與 `tokensDebug`，設定後會將 OAuth 權杖快取於指定檔案。

#### 四、啟動流程（`main.js`）
1. 以 `prismarine-tokens-fixed` 進行權杖流程後建立 bot（Mineflayer）。
2. `spawn` 後：
   - 載入 `mineflayer-collectblock` 外掛（目前未直接呼叫採集流程）。
   - 建立終端機輸入至遊戲內聊天的橋接。
   - 註冊聊天樣式規則，用於解析 TPA 相關訊息格式。
   - 等待短暫 Ticks 並輸出啟動完成訊息。
3. 註冊事件處理：訊息處理、TPA、死亡、被踢、錯誤、結束自動重連、disconnect 封包除錯輸出。

#### 五、功能清單
- 聊天橋接：
  - 終端機輸入的每一行會由 bot 在伺服器內發言。

- TPA 白名單：
  - 偵測訊息中「請求您傳送過去 / 請求傳送過來」。
  - 若發起者在 `whitelist` 內，回覆 `/tpyes`；否則回覆 `/tpno`。

- 私訊指令觸發：
  - 解析伺服器訊息格式後取得 `ID` 與 `msg`，對特定 `msg` 觸發自動化：
    - `dropall`：丟出背包所有物品（目前未設「保留清單」）。
    - `job`：自動打開並點擊職業選單（固定槽位，預設為漁夫）。
    - `gorpg`：開啟主選單並自動切換到 RPG 分流（固定槽位）。

- 死亡自動處理：
  - 死亡後等待少量 Ticks，自動輸出死亡次數並執行 `/back` 返回。

- 自動重連：
  - 連線結束（`end`）後，5 秒自動嘗試重連。

- 被踢/斷線除錯：
  - `kicked`：輸出 `loggedIn` 與完整 `reason`（JSON 格式）。
  - `_client disconnect`：輸出原始 `disconnect` 封包內容。

- 其他：
  - `checkTimeoutInterval` 可調整 keepalive 逾時（預設 90000ms，建議依網路狀況調整）。
  - `settings.json` 內含物資箱座標與傳送點鍵名，但目前未在邏輯中使用。
  - `config/Ore_list.json` 含玩家/倉儲數據樣板（`deposit`/`stake`），目前未使用。

#### 六、依賴套件（主要）
- mineflayer：核心機器人。
- mineflayer-collectblock：方塊採集外掛（尚未串接流程）。
- prismarine-tokens-fixed：權杖快取與登入協助。
- prismarine-nbt、minecraft-data 等 Prismarine 生態系模組。

#### 七、限制與風險
- GUI 點擊採固定槽位，伺服器介面調整即失效。
- `dropall` 無保護清單，可能丟出重要物品。
- 伺服器若有代理/驗證/反外掛機制，可能因協議差異或品牌檢測而被拒。
- `settings.json`、`Ore_list.json`、`nbt` 目前未整合進實際流程。

#### 八、操作建議
- 明確設定 `config.json.version` 為伺服器實際 Java 版本，或留空自動偵測。
- 若遇逾時或被踢，先查看 console 中的 `=== KICKED ===` 或 `=== DISCONNECT PACKET ===` 內容再處理。
- 真實伺服器規則（白名單、登入/註冊、人機驗證、資源包）需按踢出訊息追加對應邏輯。

#### 九、可擴充方向（未實作）
- 將 `settings.json` 的座標與傳送點整合為自動導航/傳送流程。
- 為 `dropall` 增加保護名單與 UI 指令。
- 加入 `pathfinder` 自動移動與採集任務排程。
- 將 `Ore_list.json` 資料接入經濟/倉儲管理邏輯。


